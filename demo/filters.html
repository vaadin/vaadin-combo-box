<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>vaadin-combo-box Filter Examples</title>

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>

  <link rel="import" href="common.html">
</head>

<body unresolved>
  <div class="vertical-section-container centered">
    <nav class="vertical-section">
      <ul class="layout horizontal wrap">
        <li><a href="index.html">Basic Examples</a></li>
        <li><a href="objects.html">Object Items</a></li>
        <li><a href="advanced.html">Advanced Usage</a></li>
        <li><b>Custom Filters</b></li>
      </ul>
    </nav>

    <h3>Ajax Filtering</h3>
    <p>
      By default, <code>vaadin-combo-box</code> provides a basic filtering feature that removes those items that does not match the user input.<br />
      You can disable the internal filtering by setting the property `filter-disabled`. <br />
      In addition, you can listen to changes in the `filter` property, and set the items collection based on any criteria.<br />
    </p>
    <p>In this example we link `&lt;iron-ajax>` and `&lt;vaadin-combo-box>` elements in order to update items
      based on AJAX requests sent to the <a href="https://developer.github.com/v3/search/">Github Search</a> service.</p>

      <demo-snippet>
        <template>
          <dom-module id="github-search">
            <template>
              <iron-ajax id='ajax'
                url="https://api.github.com/search/repositories?sort=starts&q={{filter}}"
                handle-as="json" method="get" last-response={{ajaxResponse}}>
              </iron-ajax>

              <vaadin-combo-box id="box" value="{{url}}" items="{{ajaxResponse.items}}"
                item-label-path="full_name" item-value-path="html_url"
                filter="{{filter}}" filter-disabled >
              </vaadin-combo-box>

            <a href="[[url]]" target="_blank">[[url]]</a>
          </template>

          <script>
            Polymer({
              is: "github-search",

              observers: ['_onFilter(filter)'],

              _onFilter: function(filter) {
                // Not using the `auto` feature in `<iron-ajax>` to avoid reaching github rate limit
                if (filter) {
                  this.debounce('filter', function() {
                    this.$.ajax.generateRequest();
                  }.bind(this), 500);
                }
              },
            });
          </script>
        </dom-module>

        <github-search></github-search>
      </template>
    </demo-snippet>

    <h3>Highlighting Filtered Items</h3>
    <p>
      By providing dom elements to the item object, we can hightlight filter results as it is shown in the followind example.
    </p>

    <demo-snippet>
      <template>
        <dom-module id="language-ajax">
            <template>
              <vaadin-combo-box item-label-path="language" item-value-path="language"
                items="{{items}}" filter="{{filter}}">
              </vaadin-combo-box>
            </template>

          <script>
            Polymer({
              is: "language-ajax",

              properties: {
                items: {
                  type: Object,
                  value: languagesJson
                }
              },

              observers : ['_onFilter(filter)'],

              _onFilter: function(filter) {
                this.items.forEach(function(item) {
                  item.element = item.element || document.createElement('span');
                  var html = item.language.replace(RegExp('(' + filter + ')', 'i'), '<strong>$1</strong>');
                  item.element.innerHTML = html + ' (' + item.population + ' m)';
                });
              },
            });
          </script>
        </dom-module>

        <language-ajax></language-ajax>
      </template>
    </demo-snippet>

    <h3>Advanced Filtering</h3>
    <p>In the following example we show how to do customised searchs and highlight the results.

    <demo-snippet>
      <template>
        <dom-module id="language-search">
          <template>
            <vaadin-combo-box item-label-path="language" item-value-path="language"
              items="[[items]]"
              filter="{{filter}}" filter-disabled>
            </vaadin-combo-box>
          </template>

          <script>

            Polymer({
              is: "language-search",

              observers : ['_onFilter(filter)'],

              _onFilter: function(filter) {
                // Regular expresion that matches a sequence of characters in a word.
                var regexpr = RegExp('(.*?)' + filter.replace(/(.)/g, '($1)(.*?)'), 'i');
                // Replacement for the given regular expression. It wraps matched groups with <strong>.
                var replace = '$1' + filter.replace(/(.)/g, function(c, c, i) {
                  return '<strong>$' + (2 * i + 2) + '</strong>$' + (2 * i + 3);
                });

                this.items = languagesJson.filter(function(item) {
                  // Filter code
                  return regexpr.test(item.language);
                }).map(function(item) {
                  // update displayed element
                  item.element = item.element || document.createElement('span');
                  var html = item.language.replace(regexpr, replace) + ' (' + item.population + ' mill)';
                  item.element.innerHTML = html;
                  return item;
                });;
              },
            });
          </script>
        </dom-module>

        <language-search></language-search>
      </template>
    </demo-snippet>

  </div>
</body>

</html>
