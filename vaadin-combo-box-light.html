<link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="vaadin-combo-box-behavior.html">
<link rel="import" href="vaadin-combo-box-overlay.html">
<link rel="import" href="vaadin-combo-box-shared-styles.html">

<dom-module id="vaadin-combo-box-light">
  <style include="vaadin-combo-box-shared-styles">
    :host > #overlay {
      display: none;
    }
  </style>

  <template>
    <content></content>

    <vaadin-combo-box-overlay
        id="overlay"
        _aria-active-index="{{_ariaActiveIndex}}"
        position-target="[[inputElement]]"
        _focused-index="[[_focusedIndex]]"
        _item-label-path="[[itemLabelPath]]"
        on-down="_onOverlayDown"
        vertical-offset="[[overlayVerticalOffset]]">
    </vaadin-combo-box-overlay>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'vaadin-combo-box-light',

    behaviors: [
      Polymer.IronA11yKeysBehavior,
      vaadin.elements.combobox.ComboBoxBehavior
    ],

    properties: {
      attrForValue: {
        type: String,
        value: 'bind-value'
      },
      overlayVerticalOffset: {
        type: Number,
        value: 0
      }
    },

    attached: function() {
      this._inputElement = Polymer.dom(this).querySelector('input[is="iron-input"],paper-input,.paper-input-input,.input');
      this._toggleElement = Polymer.dom(this).querySelector('.toggle-button');
      this._clearElement = Polymer.dom(this).querySelector('.clear-button');

      this._revertInputValue();
      this.listen(this, 'down', '_preventDefault');
      this.listen(this._inputElement, 'input', '_inputValueChanged');
      this.listen(this._inputElement, 'blur', '_onBlur');
    },

    // document.activeElement doesn't return elements from inside shadow root
    _focusedInput: function() {
      return Polymer.dom(this).querySelector('input:focus');
    },

    get _propertyForValue() {
      return Polymer.CaseMap.dashToCamelCase(this.attrForValue);
    },

    get _inputElementValue() {
      return this._inputElement && this._inputElement[this._propertyForValue];
    },

    set _inputElementValue(value) {
      if (this._inputElement) {
        this._inputElement[this._propertyForValue] = value;
      }
    }
  });
</script>
