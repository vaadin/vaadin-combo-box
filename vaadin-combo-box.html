<!--
@element vaadin-combo-box
-->

<link rel='import' href='../polymer/polymer.html'>
<link rel='import' href='../paper-input/paper-input-container.html'>
<link rel='import' href='../iron-input/iron-input.html'>
<link rel='import' href='../iron-icons/iron-icons.html'>
<link rel='import' href='../iron-icon/iron-icon.html'>
<link rel='import' href='../iron-form-element-behavior/iron-form-element-behavior.html'>
<link rel='import' href='../iron-validatable-behavior/iron-validatable-behavior.html'>
<link rel="import" href="../iron-list/iron-list.html">
<link rel='import' href='vaadin-adaptive-overlay.html'>

<dom-module id='vaadin-combo-box'>
  <style>
    /* Temporary styles */

    #selector {
      background: #FFF;
    }

    .item {
      cursor: pointer;
      padding: 16px 22px;
      border-bottom: 1px solid #DDD;
    }

    .item:hover {
      background: #EEE;
    }

    .item[selected] {
      background-color: var(--google-grey-100);
    }
  </style>

  <template>
    <paper-input-container on-tap='open'>
      <input id='input' is='iron-input' bind-value='[[value]]' name$='[[name]]' type='text' required$="[[required]]">
      <iron-icon icon='arrow-drop-down' suffix></iron-icon>
    </paper-input-container>

    <vaadin-adaptive-overlay id='overlay' opened={{opened}}>
      <iron-list id="selector" items="[[items]]" selected-item="{{value}}" selection-enabled>
        <template>
          <div selected$=[[selected]] class="item">[[item]]</div>
        </template>
      </iron-list>
    </vaadin-adaptive-overlay>
  </template>
</dom-module>

<script>
  Polymer({
    is: 'vaadin-combo-box',
    behaviors: [
      Polymer.IronFormElementBehavior,
      Polymer.IronValidatableBehavior
    ],
    properties: {
      /**
       * True if the dropdown is open, false otherwise.
       */
      opened: {
        type: Boolean,
        notify: true,
        value: false,
        observer: '_openedChanged'
      },
      /**
       * The value for this element.
       */
      value: {
        type: String,
        notify: true,
        observer: 'close'
      }
    },
    /**
     * Open the overlay.
     */
    open: function() {
      this.$.overlay.open();
    },

    _openedChanged: function() {
      if(!this.opened) {
        this.$.input.bindValue = this.value;
      }
    },

    /**
     * Close the overlay.
     */
    close: function() {
      this.$.overlay.close();
    },

    /**
    * Validates the input element and sets an error style if needed.
    *
    * @return {boolean}
    */
    _getValidity: function(){
      return this.$.input.validate();
    }

  });
</script>
